
Чтобы решить эту проблему, нам нужно заменить индексы массива на генерационные дескрипторы. Давайте обсудим, что это значит.

Пул похож на наш массив данных. Это типизированный массив объектов, но теперь он также имеет дополнительный массив счетчика поколений. Счетчик поколений сообщает, сколько раз слот был повторно использован. Счетчик увеличивается, когда текущие данные в этом слоте освобождаются.

У нас также есть список свободных мест в пуле. Список свободных мест — это просто линейный массив, содержащий индексы каждого свободного слота. Он имеет семантику стека. Когда вы выделяете новый объект, вы выталкиваете свободный индекс сверху. Когда вы удаляете объект, вы помещаете индекс освобожденного слота наверх свободного списка. Это обе быстрые операции O(1). Когда свободный список заканчивается, мы удваиваем размер пула. Это безопасно, так как никому не разрешено иметь прямые ссылки указателя на данные в массиве. Все ссылки выполняются с помощью дескрипторов.

Дескриптор — это просто структура POD. Он содержит индекс массива, как и на предыдущем слайде, но теперь у нас также есть счетчик поколений рядом с ним. Это в общей сложности 32 бита (например, 16+16 битное разделение) или 64 бита (32 + 32 бита), в зависимости от того, сколько одновременно активных ресурсов вам требуется и насколько короткое время жизни объектов. В HypeHype мы используем 32-битные (16+16) дескрипторы для всех графических ресурсов, этого достаточно для 65536 ресурсов каждого конкретного типа.
